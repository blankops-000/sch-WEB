<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gallery - Outering Schools</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg { background: linear-gradient(135deg, #059669 0%, #047857 100%); }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .gallery-item { cursor: pointer; }
        .modal { backdrop-filter: blur(10px); }
    </style>
</head>
<body class="font-sans bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center overflow-hidden">
                        <img src="OUT.jpeg" alt="Outering School Logo" class="w-10 h-10 object-cover rounded-lg">
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold">Outering Schools</h1>
                        <p class="text-sm opacity-90">Gallery</p>
                    </div>
                </div>
                <nav class="hidden md:flex space-x-6">
                    <a href="home.html" class="hover:text-yellow-300 transition">Home</a>
                    <a href="gallery.html" class="text-yellow-300">Gallery</a>
                    <a href="admin.html" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg transition">
                        <i class="fas fa-user-shield mr-2"></i>Admin
                    </a>
                </nav>
                <button class="md:hidden text-white" onclick="toggleMobileMenu()">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
            <div id="mobileMenu" class="hidden md:hidden mt-4 pb-4">
                <div class="flex flex-col space-y-3">
                    <a href="home.html" class="hover:text-yellow-300 transition">Home</a>
                    <a href="gallery.html" class="text-yellow-300">Gallery</a>
                    <a href="admin.html" class="bg-white/10 hover:bg-white/20 px-4 py-2 rounded-lg transition inline-block">
                        <i class="fas fa-user-shield mr-2"></i>Admin
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Gallery Section -->
    <section class="py-16">
        <div class="max-w-7xl mx-auto px-4">
            <div class="text-center mb-12">
                <h2 class="text-4xl font-bold text-gray-900 mb-4">School Gallery</h2>
                <p class="text-xl text-gray-600">Capturing memories and moments at Outering Schools</p>
            </div>

            <!-- Filter Tabs -->
            <div class="flex justify-center mb-8">
                <div class="bg-white rounded-lg p-1 shadow-md">
                    <button onclick="filterGallery('all')" class="filter-btn active px-6 py-2 rounded-md transition">All</button>
                    <button onclick="filterGallery('photos')" class="filter-btn px-6 py-2 rounded-md transition">Photos</button>
                    <button onclick="filterGallery('videos')" class="filter-btn px-6 py-2 rounded-md transition">Videos</button>
                </div>
            </div>

            <!-- Gallery Grid -->
            <div id="galleryContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Items will be loaded here -->
            </div>

            <!-- Upload Section (Admin Only) -->
            <div id="uploadSection" class="hidden mt-12 bg-white rounded-xl p-8 shadow-lg">
                <h3 class="text-2xl font-bold text-gray-900 mb-6">Upload Media</h3>
                <div class="grid md:grid-cols-2 gap-8">
                    <div>
                        <h4 class="text-lg font-semibold mb-4">Upload Photo</h4>
                        <input type="file" id="photoInput" accept="image/*" class="mb-4 w-full">
                        <input type="text" id="photoTitle" placeholder="Photo title" class="w-full p-3 border rounded-lg mb-4">
                        <textarea id="photoDescription" placeholder="Photo description" class="w-full p-3 border rounded-lg mb-4 h-24"></textarea>
                        <button onclick="uploadPhoto()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition">
                            <i class="fas fa-upload mr-2"></i>Upload Photo
                        </button>
                    </div>
                    <div>
                        <h4 class="text-lg font-semibold mb-4">Add Video</h4>
                        <input type="url" id="videoUrl" placeholder="YouTube video URL" class="w-full p-3 border rounded-lg mb-4">
                        <input type="text" id="videoTitle" placeholder="Video title" class="w-full p-3 border rounded-lg mb-4">
                        <textarea id="videoDescription" placeholder="Video description" class="w-full p-3 border rounded-lg mb-4 h-24"></textarea>
                        <button onclick="uploadVideo()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition">
                            <i class="fas fa-video mr-2"></i>Add Video
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Modal -->
    <div id="mediaModal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 modal">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl max-w-4xl w-full max-h-[90vh] overflow-auto">
                <div class="p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 id="modalTitle" class="text-2xl font-bold text-gray-900"></h3>
                        <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times text-2xl"></i>
                        </button>
                    </div>
                    <div id="modalContent" class="mb-4"></div>
                    <p id="modalDescription" class="text-gray-600"></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let galleryItems = [];
        let currentFilter = 'all';

        // Check if user is admin
        function isAdmin() {
            const adminUser = localStorage.getItem('admin_user');
            return adminUser !== null;
        }

        // Load gallery items
        function loadGallery() {
            const savedItems = localStorage.getItem('gallery_items');
            if (savedItems) {
                galleryItems = JSON.parse(savedItems).filter(item => item.published !== false);
            } else {
                // Default items
                galleryItems = [
                    {
                        id: 1,
                        type: 'photo',
                        title: 'School Assembly',
                        description: 'Weekly school assembly with students and staff',
                        url: 'https://via.placeholder.com/400x300?text=School+Assembly',
                        date: '2024-01-15',
                        published: true
                    },
                    {
                        id: 2,
                        type: 'video',
                        title: 'School Anthem',
                        description: 'Students singing our school anthem',
                        url: 'https://youtu.be/GqfbYaHTzoE',
                        date: '2024-01-10',
                        published: true
                    },
                    {
                        id: 3,
                        type: 'photo',
                        title: 'Science Fair',
                        description: 'Annual science fair showcasing student projects',
                        url: 'https://via.placeholder.com/400x300?text=Science+Fair',
                        date: '2024-01-08',
                        published: true
                    }
                ];
            }
            renderGallery();
        }

        // Render gallery
        function renderGallery() {
            const container = document.getElementById('galleryContainer');
            const filteredItems = currentFilter === 'all' ? galleryItems : galleryItems.filter(item => item.type === currentFilter);
            
            container.innerHTML = filteredItems.map(item => `
                <div class="gallery-item bg-white rounded-xl shadow-lg overflow-hidden card-hover" onclick="openModal(${item.id})">
                    ${item.type === 'photo' ? 
                        `<img src="${item.url}" alt="${item.title}" class="w-full h-48 object-cover">` :
                        `<div class="w-full h-48 bg-gray-200 flex items-center justify-center">
                            <i class="fas fa-play-circle text-6xl text-red-600"></i>
                        </div>`
                    }
                    <div class="p-4">
                        <h3 class="text-lg font-bold text-gray-900 mb-2">${item.title}</h3>
                        <p class="text-gray-600 text-sm mb-2">${item.description}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">${new Date(item.date).toLocaleDateString()}</span>
                            <span class="px-2 py-1 bg-${item.type === 'photo' ? 'green' : 'blue'}-100 text-${item.type === 'photo' ? 'green' : 'blue'}-800 text-xs rounded-full">
                                ${item.type === 'photo' ? 'Photo' : 'Video'}
                            </span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Filter gallery
        function filterGallery(type) {
            currentFilter = type;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderGallery();
        }

        // Open modal
        function openModal(itemId) {
            const item = galleryItems.find(i => i.id === itemId);
            if (!item) return;

            document.getElementById('modalTitle').textContent = item.title;
            document.getElementById('modalDescription').textContent = item.description;
            
            const modalContent = document.getElementById('modalContent');
            if (item.type === 'photo') {
                modalContent.innerHTML = `<img src="${item.url}" alt="${item.title}" class="w-full rounded-lg">`;
            } else {
                const videoId = extractYouTubeId(item.url);
                modalContent.innerHTML = `
                    <div class="aspect-video">
                        <iframe src="https://www.youtube.com/embed/${videoId}" 
                                class="w-full h-full rounded-lg" 
                                frameborder="0" 
                                allowfullscreen>
                        </iframe>
                    </div>
                `;
            }
            
            document.getElementById('mediaModal').classList.remove('hidden');
        }

        // Close modal
        function closeModal() {
            document.getElementById('mediaModal').classList.add('hidden');
        }

        // Extract YouTube video ID
        function extractYouTubeId(url) {
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }

        // Upload photo
        function uploadPhoto() {
            const fileInput = document.getElementById('photoInput');
            const title = document.getElementById('photoTitle').value;
            const description = document.getElementById('photoDescription').value;
            
            if (!fileInput.files[0] || !title) {
                alert('Please select a photo and enter a title');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const newItem = {
                    id: Date.now(),
                    type: 'photo',
                    title: title,
                    description: description,
                    url: e.target.result,
                    date: new Date().toISOString().split('T')[0]
                };
                
                galleryItems.unshift(newItem);
                localStorage.setItem('gallery_items', JSON.stringify(galleryItems));
                renderGallery();
                
                // Clear form
                fileInput.value = '';
                document.getElementById('photoTitle').value = '';
                document.getElementById('photoDescription').value = '';
                
                alert('Photo uploaded successfully!');
            };
            reader.readAsDataURL(fileInput.files[0]);
        }

        // Upload video
        function uploadVideo() {
            const url = document.getElementById('videoUrl').value;
            const title = document.getElementById('videoTitle').value;
            const description = document.getElementById('videoDescription').value;
            
            if (!url || !title) {
                alert('Please enter a video URL and title');
                return;
            }
            
            const newItem = {
                id: Date.now(),
                type: 'video',
                title: title,
                description: description,
                url: url,
                date: new Date().toISOString().split('T')[0]
            };
            
            galleryItems.unshift(newItem);
            localStorage.setItem('gallery_items', JSON.stringify(galleryItems));
            renderGallery();
            
            // Clear form
            document.getElementById('videoUrl').value = '';
            document.getElementById('videoTitle').value = '';
            document.getElementById('videoDescription').value = '';
            
            alert('Video added successfully!');
        }

        // Toggle mobile menu
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobileMenu');
            mobileMenu.classList.toggle('hidden');
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadGallery();
            
            // Add active class styling
            const style = document.createElement('style');
            style.textContent = `
                .filter-btn.active {
                    background-color: #059669;
                    color: white;
                }
                .filter-btn:hover {
                    background-color: #f3f4f6;
                }
                .filter-btn.active:hover {
                    background-color: #047857;
                }
            `;
            document.head.appendChild(style);
        });

        // Close modal when clicking outside
        document.getElementById('mediaModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>